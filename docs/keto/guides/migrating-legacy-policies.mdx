---
id: migrating-legacy-policies
title: Migrating policies from 0.5 to 0.6
---

0.6 release makes Ory Access Control Policy DSL modeled after AWS IAM Policies obsolete. This guide will help you to rewrite your policies in to [relation-tuples](https://www.ory.sh/docs/keto/concepts/relation-tuples)

## Legacy rules example

The policy below allows `Alice` and `Bob` to create/read/modify/delete `blog_posts:my-first-blog-post`, `blog_posts:2`, and `blog_posts:3`.

```json
{
  "subjects": ["alice", "bob"],
  "resources": [
    "blog_posts:my-first-blog-post",
    "blog_posts:2",
    "blog_posts:3"
  ],
  "actions": ["delete", "create", "read", "modify"],
  "effect": "allow"
}
```

## Rewriting it to relation tuples

According to the example above we need to create required [namespace](https://www.ory.sh/docs/keto/concepts/namespaces) and [relationship tuple](https://www.ory.sh/docs/keto/concepts/relation-tuples)

Let's add the following content to `keto.yml` configuration file. You can find a [good template](https://github.com/ory/keto/blob/master/config/keto.yml) to start with


```yaml
namespaces:
  - id: 0
  name: blog_posts

serve:
  read:
    host: 0.0.0.0
    port: 4466
  write:
    host: 0.0.0.0
    port: 4467
```

General mapping from old to new policies

- Subjects -> Subject or Subject Sets
- Resources -> Namespaces with Objects
- Actions -> Relations
- Effect -> Relations or obsolete

## Alice relationship tuples

Let's create a `alice_policies` file with the following content which adds exaclty same permissions to Alice as previous example

```
blog_posts:my-first-blog-post#read@alice
blog_posts:my-first-blog-post#modify@alice
blog_posts:my-first-blog-post#delete@alice
blog_posts:my-first-blog-post#create@alice
blog_posts:2#read@alice
blog_posts:2#modify@alice
blog_posts:2#delete@alice
blog_posts:2#create@alice
blog_posts:3#read@alice
blog_posts:3#modify@alice
blog_posts:3#delete@alice
blog_posts:3#create@alice
```
You can create a similar `bob_policies` file with similar permissions

```
blog_posts:my-first-blog-post#read@bob
blog_posts:my-first-blog-post#modify@bob
blog_posts:my-first-blog-post#delete@bob
blog_posts:my-first-blog-post#create@bob
blog_posts:2#read@bob
blog_posts:2#modify@bob
blog_posts:2#delete@bob
blog_posts:2#create@bob
blog_posts:3#read@bob
blog_posts:3#modify@bob
blog_posts:3#delete@bob
blog_posts:3#create@bob
```

## Creating rules using Cli

```bash
keto relation-tuple parse alice_policies- --format json | \
  keto relation-tuple create - >/dev/null \
  && echo "Successfully created tuple" \
  || echo "Encountered error"

```

Bob
```bash
keto relation-tuple parse bob_policies- --format json | \
  keto relation-tuple create - >/dev/null \
  && echo "Successfully created tuple" \
  || echo "Encountered error"

```
## Next steps

- [Check whether a User has Access to Something](https://www.ory.sh/docs/keto/guides/simple-access-check-guide)
- [List API: Display all Objects a User has Access to](https://www.ory.sh/docs/keto/guides/list-api-display-objects)
